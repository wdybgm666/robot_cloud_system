<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>任务管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            padding-top: 20px;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        
        .card-header {
            background-color: #3a6ea5;
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: #ffc107;
            color: #000;
        }
        
        .status-in_progress {
            background-color: #17a2b8;
            color: #fff;
        }
        
        .status-paused {
            background-color: #6c757d;
            color: #fff;
        }
        
        .status-completed {
            background-color: #28a745;
            color: #fff;
        }
        
        .status-failed {
            background-color: #dc3545;
            color: #fff;
        }
        
        .status-cancelled {
            background-color: #343a40;
            color: #fff;
        }
        
        .task-item {
            border-left: 4px solid #3a6ea5;
            transition: transform 0.3s ease;
        }
        
        .task-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .priority-high {
            border-left-color: #dc3545;
        }
        
        .priority-medium {
            border-left-color: #ffc107;
        }
        
        .priority-low {
            border-left-color: #28a745;
        }
        
        .param-section {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4"><i class="bi bi-list-task"></i> 任务管理系统</h1>
            </div>
        </div>
        
        <!-- 创建任务表单 -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-plus-circle"></i> 创建新任务
                    </div>
                    <div class="card-body">
                        <form id="create-task-form">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="task-name" class="form-label">任务名称</label>
                                    <input type="text" class="form-control" id="task-name" required>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="task-type" class="form-label">任务类型</label>
                                    <select class="form-select" id="task-type" required>
                                        <option value="">请选择任务类型</option>
                                        <option value="navigation">导航任务</option>
                                        <option value="inspection">巡检任务</option>
                                        <option value="data_collection">数据采集</option>
                                        <option value="charging">充电任务</option>
                                        <option value="maintenance">维护任务</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="task-priority" class="form-label">优先级</label>
                                    <select class="form-select" id="task-priority" required>
                                        <option value="">请选择优先级</option>
                                        <option value="high">高</option>
                                        <option value="medium">中</option>
                                        <option value="low">低</option>
                                    </select>
                                </div>
                                <div class="col-md-2 mb-3 d-flex align-items-end">
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-plus"></i> 创建
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 不同类型任务的参数输入区域 -->
                            <div id="task-parameters-section">
                                <!-- 导航任务参数 -->
                                <div class="param-section" id="navigation-params">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h5><i class="bi bi-geo-alt"></i> 导航参数</h5>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="nav-x" class="form-label">X 坐标</label>
                                            <input type="number" class="form-control" id="nav-x" step="0.1" placeholder="例如: 1.5">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="nav-y" class="form-label">Y 坐标</label>
                                            <input type="number" class="form-control" id="nav-y" step="0.1" placeholder="例如: 2.0">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="nav-theta" class="form-label">朝向 (角度)</label>
                                            <input type="number" class="form-control" id="nav-theta" step="1" placeholder="例如: 0">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 巡检任务参数 -->
                                <div class="param-section" id="inspection-params">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h5><i class="bi bi-eye"></i> 巡检参数</h5>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="inspection-points" class="form-label">巡检点数量</label>
                                            <input type="number" class="form-control" id="inspection-points" min="1" value="1">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="inspection-duration" class="form-label">每个点停留时间(秒)</label>
                                            <input type="number" class="form-control" id="inspection-duration" min="1" value="30">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 数据采集任务参数 -->
                                <div class="param-section" id="data-collection-params">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h5><i class="bi bi-database"></i> 数据采集参数</h5>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="data-type" class="form-label">数据类型</label>
                                            <select class="form-select" id="data-type">
                                                <option value="lidar">激光雷达数据</option>
                                                <option value="camera">摄像头数据</option>
                                                <option value="imu">IMU数据</option>
                                                <option value="all">全部数据</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="collection-duration" class="form-label">采集时长(秒)</label>
                                            <input type="number" class="form-control" id="collection-duration" min="1" value="60">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 通用参数 -->
                                <div class="param-section" id="generic-params">
                                    <div class="row">
                                        <div class="col-md-12 mb-3">
                                            <label for="task-parameters" class="form-label">其他参数 (JSON格式，可选)</label>
                                            <textarea class="form-control" id="task-parameters" rows="3" placeholder='{"key": "value"}'></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 任务列表 -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-list-check"></i> 任务列表</span>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-success" id="execute-all-tasks">
                                <i class="bi bi-play-fill"></i> 执行所有任务
                            </button>
                            <button class="btn btn-sm btn-outline-light" id="refresh-tasks">
                                <i class="bi bi-arrow-clockwise"></i> 刷新
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="filter-status" class="form-label">状态筛选</label>
                                <select class="form-select" id="filter-status">
                                    <option value="">全部状态</option>
                                    <option value="pending">待处理</option>
                                    <option value="in_progress">进行中</option>
                                    <option value="paused">已暂停</option>
                                    <option value="completed">已完成</option>
                                    <option value="failed">已失败</option>
                                    <option value="cancelled">已取消</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="filter-priority" class="form-label">优先级筛选</label>
                                <select class="form-select" id="filter-priority">
                                    <option value="">全部优先级</option>
                                    <option value="high">高</option>
                                    <option value="medium">中</option>
                                    <option value="low">低</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="filter-type" class="form-label">类型筛选</label>
                                <select class="form-select" id="filter-type">
                                    <option value="">全部类型</option>
                                    <option value="navigation">导航任务</option>
                                    <option value="inspection">巡检任务</option>
                                    <option value="data_collection">数据采集</option>
                                    <option value="charging">充电任务</option>
                                    <option value="maintenance">维护任务</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="task-list">
                            <!-- 任务列表将通过JavaScript动态生成 -->
                            <div class="text-center py-5">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">加载中...</span>
                                </div>
                                <p class="mt-2">正在加载任务列表...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 任务详情模态框 -->
    <div class="modal fade" id="taskDetailModal" tabindex="-1" aria-labelledby="taskDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskDetailModalLabel">任务详情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="task-detail-content">
                        <!-- 任务详情将通过JavaScript动态生成 -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 全局变量
        let tasks = [];
        
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定事件
            document.getElementById('create-task-form').addEventListener('submit', createTask);
            document.getElementById('refresh-tasks').addEventListener('click', loadTasks);
            document.getElementById('execute-all-tasks').addEventListener('click', executeAllTasks);
            
            // 绑定任务类型变化事件
            document.getElementById('task-type').addEventListener('change', toggleParamSection);
            
            // 绑定筛选事件
            document.getElementById('filter-status').addEventListener('change', filterTasks);
            document.getElementById('filter-priority').addEventListener('change', filterTasks);
            document.getElementById('filter-type').addEventListener('change', filterTasks);
            
            // 加载任务列表
            loadTasks();
        });
        
        // 根据任务类型显示相应参数输入区域
        function toggleParamSection() {
            const taskType = document.getElementById('task-type').value;
            
            // 隐藏所有参数区域
            document.querySelectorAll('.param-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // 显示对应类型的参数区域
            if (taskType === 'navigation') {
                document.getElementById('navigation-params').style.display = 'block';
            } else if (taskType === 'inspection') {
                document.getElementById('inspection-params').style.display = 'block';
            } else if (taskType === 'data_collection') {
                document.getElementById('data-collection-params').style.display = 'block';
            }
            
            // 总是显示通用参数区域
            document.getElementById('generic-params').style.display = 'block';
        }
        
        // 加载任务列表
        function loadTasks() {
            axios.get('/api/tasks')
                .then(response => {
                    tasks = response.data;
                    renderTaskList();
                })
                .catch(error => {
                    console.error('加载任务列表失败:', error);
                    document.getElementById('task-list').innerHTML = `
                        <div class="alert alert-danger">
                            <i class="bi bi-exclamation-triangle"></i> 加载任务列表失败: ${error.response?.data?.error || error.message}
                        </div>
                    `;
                });
        }
        
        // 创建任务
        function createTask(event) {
            event.preventDefault();
            
            const name = document.getElementById('task-name').value;
            const type = document.getElementById('task-type').value;
            const priority = document.getElementById('task-priority').value;
            
            // 根据任务类型构建参数
            let parameters = {};
            
            if (type === 'navigation') {
                const x = document.getElementById('nav-x').value;
                const y = document.getElementById('nav-y').value;
                const theta = document.getElementById('nav-theta').value;
                
                if (x || y) {
                    parameters = {
                        x: parseFloat(x) || 0,
                        y: parseFloat(y) || 0,
                        theta: parseFloat(theta) || 0
                    };
                }
            } else if (type === 'inspection') {
                const points = document.getElementById('inspection-points').value;
                const duration = document.getElementById('inspection-duration').value;
                
                parameters = {
                    points: parseInt(points) || 1,
                    duration: parseInt(duration) || 30
                };
            } else if (type === 'data_collection') {
                const dataType = document.getElementById('data-type').value;
                const duration = document.getElementById('collection-duration').value;
                
                parameters = {
                    data_type: dataType,
                    duration: parseInt(duration) || 60
                };
            }
            
            // 添加通用参数
            const genericParams = document.getElementById('task-parameters').value;
            if (genericParams) {
                try {
                    const generic = JSON.parse(genericParams);
                    parameters = {...parameters, ...generic};
                } catch (e) {
                    alert('通用参数必须是有效的JSON格式');
                    return;
                }
            }
            
            const taskData = {
                name: name,
                type: type,
                priority: priority,
                parameters: JSON.stringify(parameters)
            };
            
            axios.post('/api/tasks', taskData)
                .then(response => {
                    alert('任务创建成功');
                    // 清空表单
                    document.getElementById('create-task-form').reset();
                    // 隐藏所有参数区域
                    document.querySelectorAll('.param-section').forEach(section => {
                        section.style.display = 'none';
                    });
                    // 重新加载任务列表
                    loadTasks();
                })
                .catch(error => {
                    console.error('创建任务失败:', error);
                    alert('创建任务失败: ' + (error.response?.data?.error || error.message));
                });
        }
        
        // 渲染任务列表
        function renderTaskList() {
            filterTasks();
        }
        
        function executeAllTasks() {
            axios.post('/api/tasks/execute_all')
                .then(response => {
                    const data = response.data;
                    alert(`批量执行完成：已处理 ${data.executed} 个待处理任务`);
                    loadTasks();
                })
                .catch(error => {
                    alert('批量执行失败: ' + (error.response?.data?.error || error.message));
                });
        }
        
        // 筛选任务
        function filterTasks() {
            const statusFilter = document.getElementById('filter-status').value;
            const priorityFilter = document.getElementById('filter-priority').value;
            const typeFilter = document.getElementById('filter-type').value;
            
            let filteredTasks = tasks;
            
            if (statusFilter) {
                filteredTasks = filteredTasks.filter(task => task.status === statusFilter);
            }
            
            if (priorityFilter) {
                filteredTasks = filteredTasks.filter(task => task.priority === priorityFilter);
            }
            
            if (typeFilter) {
                filteredTasks = filteredTasks.filter(task => task.type === typeFilter);
            }
            
            const taskList = document.getElementById('task-list');
            
            if (filteredTasks.length === 0) {
                taskList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-inbox fs-1 text-muted"></i>
                        <p class="mt-2 text-muted">暂无任务</p>
                    </div>
                `;
                return;
            }
            
            let taskListHtml = '';
            filteredTasks.forEach(task => {
                const createdAt = new Date(task.created_at).toLocaleString();
                const updatedAt = new Date(task.updated_at).toLocaleString();
                
                taskListHtml += `
                    <div class="card task-item mb-3 priority-${task.priority}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h5 class="card-title">${task.name}</h5>
                                    <p class="card-text">
                                        <span class="badge bg-secondary me-2">${task.type}</span>
                                        <span class="badge bg-${getPriorityClass(task.priority)} me-2">优先级: ${getPriorityText(task.priority)}</span>
                                        <span class="badge ${getStatusClass(task.status)}">状态: ${getStatusText(task.status)}</span>
                                    </p>
                                    <p class="text-muted small mb-1">
                                        <i class="bi bi-clock"></i> 创建时间: ${createdAt}
                                    </p>
                                    <p class="text-muted small mb-2">
                                        <i class="bi bi-arrow-repeat"></i> 更新时间: ${updatedAt}
                                    </p>
                                    ${task.parameters ? `<p class="small mb-0"><strong>参数:</strong> ${formatParameters(task.parameters)}</p>` : ''}
                                </div>
                                <div class="d-flex flex-column align-items-end">
                                    <button class="btn btn-sm btn-outline-primary mb-2" onclick="viewTaskDetails(${task.id})">
                                        <i class="bi bi-eye"></i> 查看详情
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteTask(${task.id})">
                                        <i class="bi bi-trash"></i> 删除任务
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                ${getActionButtons(task)}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            taskList.innerHTML = taskListHtml;
        }
        
        // 格式化参数显示
        function formatParameters(paramsStr) {
            try {
                const params = JSON.parse(paramsStr);
                let formatted = '';
                
                for (const [key, value] of Object.entries(params)) {
                    formatted += `${key}: ${value}, `;
                }
                
                return formatted.slice(0, -2); // 移除最后的逗号和空格
            } catch (e) {
                return paramsStr;
            }
        }
        
        // 根据任务状态获取操作按钮
        function getActionButtons(task) {
            let buttons = '';
            
            if (task.status === 'pending') {
                buttons += `
                    <button class="btn btn-sm btn-success me-1" onclick="updateTaskStatus(${task.id}, 'in_progress', '任务开始执行')">
                        <i class="bi bi-play"></i> 开始
                    </button>
                    <button class="btn btn-sm btn-danger me-1" onclick="updateTaskStatus(${task.id}, 'cancelled', '任务已取消')">
                        <i class="bi bi-x"></i> 取消
                    </button>
                `;
            } else if (task.status === 'in_progress') {
                buttons += `
                    <button class="btn btn-sm btn-success me-1" onclick="updateTaskStatus(${task.id}, 'completed', '任务已完成')">
                        <i class="bi bi-check"></i> 完成
                    </button>
                    <button class="btn btn-sm btn-warning me-1" onclick="updateTaskStatus(${task.id}, 'paused', '任务已暂停')">
                        <i class="bi bi-pause"></i> 暂停
                    </button>
                    <button class="btn btn-sm btn-danger me-1" onclick="updateTaskStatus(${task.id}, 'cancelled', '任务已取消')">
                        <i class="bi bi-x"></i> 取消
                    </button>
                `;
            } else if (task.status === 'paused') {
                buttons += `
                    <button class="btn btn-sm btn-success me-1" onclick="updateTaskStatus(${task.id}, 'in_progress', '任务继续执行')">
                        <i class="bi bi-play"></i> 继续
                    </button>
                    <button class="btn btn-sm btn-danger me-1" onclick="updateTaskStatus(${task.id}, 'cancelled', '任务已取消')">
                        <i class="bi bi-x"></i> 取消
                    </button>
                `;
            } else if (task.status === 'failed') {
                buttons += `
                    <button class="btn btn-sm btn-success me-1" onclick="updateTaskStatus(${task.id}, 'pending', '任务重试')">
                        <i class="bi bi-arrow-repeat"></i> 重试
                    </button>
                `;
            }
            
            return buttons;
        }
        
        // 更新任务状态
        function updateTaskStatus(taskId, newStatus, message = '') {
            axios.put(`/api/tasks/${taskId}/status`, {
                status: newStatus,
                message: message
            })
            .then(response => {
                alert('任务状态更新成功');
                loadTasks(); // 重新加载任务列表
            })
            .catch(error => {
                console.error('更新任务状态失败:', error);
                alert('更新任务状态失败: ' + (error.response?.data?.error || error.message));
            });
        }
        
        function deleteTask(taskId) {
            axios.delete(`/api/tasks/${taskId}`)
                .then(response => {
                    alert('任务删除成功');
                    loadTasks();
                })
                .catch(error => {
                    alert('任务删除失败: ' + (error.response?.data?.error || error.message));
                });
        }
        
        // 查看任务详情
        function viewTaskDetails(taskId) {
            axios.get(`/api/tasks/${taskId}`)
                .then(response => {
                    const task = response.data;
                    const createdAt = new Date(task.created_at).toLocaleString();
                    const updatedAt = new Date(task.updated_at).toLocaleString();
                    
                    let detailHtml = `
                        <div class="row">
                            <div class="col-md-6">
                                <h5>基本信息</h5>
                                <table class="table table-sm">
                                    <tr>
                                        <th>ID:</th>
                                        <td>${task.id}</td>
                                    </tr>
                                    <tr>
                                        <th>名称:</th>
                                        <td>${task.name}</td>
                                    </tr>
                                    <tr>
                                        <th>类型:</th>
                                        <td>${task.type}</td>
                                    </tr>
                                    <tr>
                                        <th>优先级:</th>
                                        <td>${getPriorityText(task.priority)}</td>
                                    </tr>
                                    <tr>
                                        <th>状态:</th>
                                        <td>${getStatusText(task.status)}</td>
                                    </tr>
                                    <tr>
                                        <th>创建时间:</th>
                                        <td>${createdAt}</td>
                                    </tr>
                                    <tr>
                                        <th>更新时间:</th>
                                        <td>${updatedAt}</td>
                                    </tr>
                                </table>
                            </div>
                            
                            <div class="col-md-6">
                                <h5>参数信息</h5>
                                ${task.parameters ? 
                                    `<pre class="bg-light p-3 rounded">${formatParametersForDetail(task.parameters)}</pre>` : 
                                    `<p class="text-muted">无参数</p>`
                                }
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <h5>操作历史</h5>
                                <div id="task-history" class="text-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">加载中...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('task-detail-content').innerHTML = detailHtml;
                    const modal = new bootstrap.Modal(document.getElementById('taskDetailModal'));
                    modal.show();
                    
                    // 加载任务历史
                    loadTaskHistory(taskId);
                })
                .catch(error => {
                    console.error('获取任务详情失败:', error);
                    alert('获取任务详情失败: ' + (error.response?.data?.error || error.message));
                });
        }
        
        // 格式化详情页参数显示
        function formatParametersForDetail(paramsStr) {
            try {
                const params = JSON.parse(paramsStr);
                return JSON.stringify(params, null, 2);
            } catch (e) {
                return paramsStr;
            }
        }
        
        // 加载任务历史
        function loadTaskHistory(taskId) {
            axios.get(`/api/tasks/${taskId}/history`)
                .then(response => {
                    const history = response.data;
                    const historyContainer = document.getElementById('task-history');
                    
                    if (history.length === 0) {
                        historyContainer.innerHTML = '<p class="text-muted text-center">暂无操作历史</p>';
                        return;
                    }
                    
                    let historyHtml = `
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>状态</th>
                                        <th>时间</th>
                                        <th>备注</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    history.forEach(record => {
                        const timestamp = new Date(record.timestamp).toLocaleString();
                        historyHtml += `
                            <tr>
                                <td><span class="badge ${getStatusClass(record.status)}">${getStatusText(record.status)}</span></td>
                                <td>${timestamp}</td>
                                <td>${record.message || '-'}</td>
                            </tr>
                        `;
                    });
                    
                    historyHtml += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    historyContainer.innerHTML = historyHtml;
                })
                .catch(error => {
                    console.error('加载任务历史失败:', error);
                    document.getElementById('task-history').innerHTML = `
                        <div class="alert alert-danger">
                            加载任务历史失败: ${error.response?.data?.error || error.message}
                        </div>
                    `;
                });
        }
        
        // 获取状态文本
        function getStatusText(status) {
            const statusMap = {
                'pending': '待处理',
                'in_progress': '进行中',
                'paused': '已暂停',
                'completed': '已完成',
                'failed': '已失败',
                'cancelled': '已取消'
            };
            return statusMap[status] || status;
        }
        
        // 获取状态CSS类
        function getStatusClass(status) {
            return `status-${status}`;
        }
        
        // 获取优先级文本
        function getPriorityText(priority) {
            const priorityMap = {
                'high': '高',
                'medium': '中',
                'low': '低'
            };
            return priorityMap[priority] || priority;
        }
        
        // 获取优先级CSS类
        function getPriorityClass(priority) {
            const priorityMap = {
                'high': 'danger',
                'medium': 'warning',
                'low': 'success'
            };
            return priorityMap[priority] || 'secondary';
        }
    </script>
</body>
</html>
