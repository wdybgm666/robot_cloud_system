<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>任务管理系统实现 - PPT课件</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f0f0f0;
            overflow-x: hidden;
        }
        
        .ppt-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .nav-container {
            background-color: #2c3e50;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-container h1 {
            font-size: 1.5rem;
            margin: 0;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-buttons button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .nav-buttons button:hover {
            background-color: #2980b9;
        }
        
        .slides-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            scroll-behavior: smooth;
        }
        
        .slide {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 0 auto 30px;
            padding: 40px;
            width: 100%;
            max-width: 1024px;
            min-height: 80vh;
            position: relative;
            overflow-y: auto;
        }
        
        .slide-title {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .slide-content {
            font-size: 1.2rem;
            line-height: 1.6;
        }
        
        .slide-content h3 {
            color: #3498db;
            margin: 20px 0 10px;
        }
        
        .slide-content h4 {
            color: #2c3e50;
            margin: 15px 0 8px;
        }
        
        .slide-content ul, .slide-content ol {
            margin: 10px 0 10px 30px;
        }
        
        .slide-content li {
            margin-bottom: 8px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        th {
            background-color: #3498db;
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            line-height: 1.4;
            white-space: pre-wrap;
        }
        
        code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .formula {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            text-align: center;
            font-style: italic;
            border-left: 4px solid #e74c3c;
        }
        
        .caption {
            font-style: italic;
            text-align: center;
            margin-top: 5px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .footer {
            text-align: center;
            padding: 10px;
            color: #7f8c8d;
            font-size: 0.9rem;
            position: absolute;
            bottom: 10px;
            width: 100%;
            left: 0;
        }
        
        .two-columns {
            display: flex;
            gap: 20px;
        }
        
        .two-columns > div {
            flex: 1;
        }
        
        @media (max-width: 768px) {
            .slide {
                padding: 20px;
                min-height: auto;
            }
            
            .two-columns {
                flex-direction: column;
            }
            
            .nav-container {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        /* 打印样式 */
        @media print {
            body {
                background-color: white;
            }
            
            .nav-container {
                display: none;
            }
            
            .slide {
                box-shadow: none;
                page-break-after: always;
                margin: 0;
                height: auto;
            }
            
            .slides-container {
                overflow: visible;
                padding: 0;
            }
        }
        
        .code-block {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            line-height: 1.4;
        }
        
        .code-header {
            background-color: #444;
            color: #ddd;
            padding: 8px 15px;
            border-radius: 5px 5px 0 0;
            font-size: 0.9rem;
            margin-top: 15px;
        }
        
        .algorithm-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }
        
        .algorithm-table th, .algorithm-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .algorithm-table th {
            background-color: #3498db;
            color: white;
        }
        
        .algorithm-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .objective-box {
            background-color: #e8f6f3;
            border-left: 4px solid #2ecc71;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .explanation-box {
            background-color: #fef9e7;
            border-left: 4px solid #f1c40f;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .implementation-box {
            background-color: #f4ecf7;
            border-left: 4px solid #9b59b6;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .evaluation-box {
            background-color: #fbeee6;
            border-left: 4px solid #e67e22;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .debug-box {
            background-color: #ffebee;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .env-box {
            background-color: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="ppt-container">
        <div class="nav-container">
            <h1>第十一次课：任务管理系统实现 - PPT课件</h1>
            <div class="nav-buttons">
                <button onclick="navigate('prev')">上一张</button>
                <button onclick="navigate('home')">回到首页</button>
                <button onclick="navigate('next')">下一张</button>
                <button onclick="exportToPDF()">导出PDF</button>
            </div>
        </div>
        
        <div class="slides-container" id="slides-container">
            <!-- 第一部分：课程内容介绍 -->
            <div class="slide" id="slide1">
                <h2 class="slide-title">一、课程内容介绍</h2>
                <div class="slide-content">
                    <p>本课程将深入讲解如何设计并实现机器人物联网云控系统的核心任务管理系统。</p>
                    
                    <div class="env-box">
                        <h3>开发环境要求</h3>
                        <ul>
                            <li><strong>操作系统：</strong>Ubuntu 22.04 LTS</li>
                            <li><strong>机器人操作系统：</strong>ROS 2 Humble Hawksbill</li>
                            <li><strong>编程语言：</strong>Python 3.10, JavaScript, HTML5, CSS3</li>
                            <li><strong>开发工具：</strong>VSCode + PlatformIO (嵌入式开发), esp-idf框架</li>
                            <li><strong>数据库：</strong>SQLite 3.37+</li>
                            <li><strong>Web框架：</strong>Flask 2.2+</li>
                        </ul>
                    </div>
                    
                    <h3>课程时间分配（总计4小时）</h3>
                    <table>
                        <tr>
                            <th>内容</th>
                            <th>时间</th>
                        </tr>
                        <tr>
                            <td>课程介绍与目标阐述</td>
                            <td>15分钟</td>
                        </tr>
                        <tr>
                            <td>数据库设计与实现</td>
                            <td>45分钟</td>
                        </tr>
                        <tr>
                            <td>任务状态机设计</td>
                            <td>40分钟</td>
                        </tr>
                        <tr>
                            <td>RESTful API设计与实现</td>
                            <td>45分钟</td>
                        </tr>
                        <tr>
                            <td>前端任务管理界面实现</td>
                            <td>40分钟</td>
                        </tr>
                        <tr>
                            <td>系统集成与测试</td>
                            <td>30分钟</td>
                        </tr>
                        <tr>
                            <td>课程总结与考核</td>
                            <td>15分钟</td>
                        </tr>
                    </table>
                </div>
                <div class="footer">第 1 页</div>
            </div>
            
            <!-- 第二部分：学习目标及与后续课程关联 -->
            <div class="slide" id="slide2">
                <h2 class="slide-title">二、学习目标及与后续课程关联</h2>
                <div class="slide-content">
                    <div class="objective-box">
                        <h3>学习目标</h3>
                        <ul>
                            <li>理解任务管理系统的基本概念和设计原则</li>
                            <li>掌握数据库设计的基本方法和技术</li>
                            <li>学会设计和实现任务状态机</li>
                            <li>掌握RESTful API的设计和实现方法</li>
                            <li>能够实现前端任务管理界面</li>
                            <li>能够将任务管理系统集成到整个云控系统中</li>
                        </ul>
                    </div>
                    
                    <div class="explanation-box">
                        <h3>与后续课程的关联</h3>
                        <table>
                            <tr>
                                <th>本次课程内容</th>
                                <th>后续课程</th>
                                <th>关联性</th>
                            </tr>
                            <tr>
                                <td>任务管理系统</td>
                                <td>系统集成与测试</td>
                                <td>任务管理系统是系统集成与测试的核心组成部分</td>
                            </tr>
                            <tr>
                                <td>数据库设计</td>
                                <td>实际应用开发</td>
                                <td>数据库设计直接影响系统的可维护性和扩展性</td>
                            </tr>
                            <tr>
                                <td>状态机设计</td>
                                <td>高级功能扩展</td>
                                <td>为任务调度、优先级管理、多机器人协同奠定基础</td>
                            </tr>
                            <tr>
                                <td>API设计</td>
                                <td>项目部署与运维</td>
                                <td>API接口设计影响系统的可维护性和扩展性</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="footer">第 2 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 1 -->
            <div class="slide" id="slide3">
                <h2 class="slide-title">三、核心技术点：任务管理系统概述</h2>
                <div class="slide-content">
                    <p>任务管理系统是机器人物联网云控系统的核心组件，负责协调和管理机器人的各种任务。</p>
                    
                    <table>
                        <tr>
                            <th>功能模块</th>
                            <th>描述</th>
                            <th>关键技术</th>
                        </tr>
                        <tr>
                            <td>任务创建</td>
                            <td>允许用户创建新任务，设置任务参数</td>
                            <td>表单处理、数据验证</td>
                        </tr>
                        <tr>
                            <td>任务存储</td>
                            <td>将任务信息持久化到数据库</td>
                            <td>数据库设计、SQL操作</td>
                        </tr>
                        <tr>
                            <td>任务调度</td>
                            <td>根据优先级和资源情况调度任务执行</td>
                            <td>调度算法、队列管理</td>
                        </tr>
                        <tr>
                            <td>状态跟踪</td>
                            <td>实时跟踪任务执行状态</td>
                            <td>状态机、WebSocket</td>
                        </tr>
                        <tr>
                            <td>结果反馈</td>
                            <td>收集和展示任务执行结果</td>
                            <td>数据可视化、报告生成</td>
                        </tr>
                    </table>
                    
                    <div class="explanation-box">
                        <p><strong>系统架构：</strong>任务管理系统采用分层架构设计，包括数据层（数据库）、业务逻辑层（状态机、API）和表示层（前端界面）。</p>
                    </div>
                </div>
                <div class="footer">第 3 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 2 -->
            <div class="slide" id="slide4">
                <h2 class="slide-title">三、核心技术点：数据库设计 - 表结构</h2>
                <div class="slide-content">
                    <p>数据库是任务管理系统的核心，负责存储任务信息、状态记录和执行结果。</p>
                    
                    <h3>任务表 (tasks)</h3>
                    <table>
                        <tr>
                            <th>字段名</th>
                            <th>类型</th>
                            <th>描述</th>
                            <th>约束</th>
                        </tr>
                        <tr>
                            <td>id</td>
                            <td>INTEGER</td>
                            <td>任务唯一标识</td>
                            <td>主键，自增</td>
                        </tr>
                        <tr>
                            <td>name</td>
                            <td>TEXT</td>
                            <td>任务名称</td>
                            <td>非空</td>
                        </tr>
                        <tr>
                            <td>type</td>
                            <td>TEXT</td>
                            <td>任务类型</td>
                            <td>非空</td>
                        </tr>
                        <tr>
                            <td>priority</td>
                            <td>TEXT</td>
                            <td>任务优先级</td>
                            <td>非空</td>
                        </tr>
                        <tr>
                            <td>status</td>
                            <td>TEXT</td>
                            <td>任务状态</td>
                            <td>非空，默认'pending'</td>
                        </tr>
                        <tr>
                            <td>parameters</td>
                            <td>TEXT</td>
                            <td>任务参数(JSON格式)</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>created_at</td>
                            <td>TIMESTAMP</td>
                            <td>创建时间</td>
                            <td>非空</td>
                        </tr>
                        <tr>
                            <td>updated_at</td>
                            <td>TIMESTAMP</td>
                            <td>更新时间</td>
                            <td>非空</td>
                        </tr>
                    </table>
                </div>
                <div class="footer">第 4 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 3 -->
            <div class="slide" id="slide5">
                <h2 class="slide-title">三、核心技术点：数据库设计 - 状态记录表</h2>
                <div class="slide-content">
                    <h3>任务状态记录表 (task_status_history)</h3>
                    <table>
                        <tr>
                            <th>字段名</th>
                            <th>类型</th>
                            <th>描述</th>
                            <th>约束</th>
                        </tr>
                        <tr>
                            <td>id</td>
                            <td>INTEGER</td>
                            <td>记录唯一标识</td>
                            <td>主键，自增</td>
                        </tr>
                        <tr>
                            <td>task_id</td>
                            <td>INTEGER</td>
                            <td>关联的任务ID</td>
                            <td>外键，非空</td>
                        </tr>
                        <tr>
                            <td>status</td>
                            <td>TEXT</td>
                            <td>状态值</td>
                            <td>非空</td>
                        </tr>
                        <tr>
                            <td>timestamp</td>
                            <td>TIMESTAMP</td>
                            <td>状态变更时间</td>
                            <td>非空</td>
                        </tr>
                        <tr>
                            <td>message</td>
                            <td>TEXT</td>
                            <td>状态变更信息</td>
                            <td></td>
                        </tr>
                    </table>
                    
                    <div class="explanation-box">
                        <p><strong>设计原则：</strong>遵循第三范式，减少数据冗余，建立适当索引提高查询性能。</p>
                    </div>
                </div>
                <div class="footer">第 5 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 4 -->
            <div class="slide" id="slide6">
                <h2 class="slide-title">三、核心技术点：数据库初始化代码</h2>
                <div class="slide-content">
                    <div class="code-header">数据库初始化代码</div>
                    <pre><code>import sqlite3
from datetime import datetime

def init_database():
    """初始化数据库"""
    conn = sqlite3.connect('tasks.db')
    c = conn.cursor()
    
    # 创建任务表
    c.execute('''CREATE TABLE IF NOT EXISTS tasks
                 (id INTEGER PRIMARY KEY AUTOINCREMENT,
                  name TEXT NOT NULL,
                  type TEXT NOT NULL,
                  priority TEXT NOT NULL,
                  status TEXT NOT NULL DEFAULT 'pending',
                  parameters TEXT,
                  created_at TIMESTAMP NOT NULL,
                  updated_at TIMESTAMP NOT NULL)''')
    
    # 创建任务状态记录表
    c.execute('''CREATE TABLE IF NOT EXISTS task_status_history
                 (id INTEGER PRIMARY KEY AUTOINCREMENT,
                  task_id INTEGER NOT NULL,
                  status TEXT NOT NULL,
                  timestamp TIMESTAMP NOT NULL,
                  message TEXT,
                  FOREIGN KEY (task_id) REFERENCES tasks (id))''')
    
    # 创建索引以提高查询性能
    c.execute('CREATE INDEX IF NOT EXISTS idx_tasks_status ON tasks (status)')
    c.execute('CREATE INDEX IF NOT EXISTS idx_tasks_priority ON tasks (priority)')
    c.execute('CREATE INDEX IF NOT EXISTS idx_status_history_task_id ON task_status_history (task_id)')
    c.execute('CREATE INDEX IF NOT EXISTS idx_status_history_timestamp ON task_status_history (timestamp)')
    
    conn.commit()
    conn.close()
    
    print("数据库初始化完成")

if __name__ == '__main__':
    init_database()
</code></pre>
                </div>
                <div class="footer">第 6 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 5 -->
            <div class="slide" id="slide7">
                <h2 class="slide-title">三、核心技术点：任务状态机设计</h2>
                <div class="slide-content">
                    <p>任务状态机定义了任务可能的状态以及状态之间的转换规则。</p>
                    
                    <table>
                        <tr>
                            <th>状态</th>
                            <th>描述</th>
                            <th>可能的下一个状态</th>
                        </tr>
                        <tr>
                            <td>pending</td>
                            <td>任务已创建，等待执行</td>
                            <td>in_progress, cancelled</td>
                        </tr>
                        <tr>
                            <td>in_progress</td>
                            <td>任务正在执行中</td>
                            <td>completed, failed, paused, cancelled</td>
                        </tr>
                        <tr>
                            <td>paused</td>
                            <td>任务已暂停</td>
                            <td>in_progress, cancelled</td>
                        </tr>
                        <tr>
                            <td>completed</td>
                            <td>任务已完成</td>
                            <td>(终态)</td>
                        </tr>
                        <tr>
                            <td>failed</td>
                            <td>任务执行失败</td>
                            <td>pending, cancelled</td>
                        </tr>
                        <tr>
                            <td>cancelled</td>
                            <td>任务已取消</td>
                            <td>(终态)</td>
                        </tr>
                    </table>
                    
                    <div class="explanation-box">
                        <p><strong>设计要点：</strong>状态机设计确保了任务状态转换的逻辑完整性，适合机器人任务管理场景。</p>
                    </div>
                </div>
                <div class="footer">第 7 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 6 -->
            <div class="slide" id="slide8">
                <h2 class="slide-title">三、核心技术点：状态机实现代码</h2>
                <div class="slide-content">
                    <div class="code-header">状态机实现代码</div>
                    <pre><code>class TaskStateMachine:
    def __init__(self):
        # 定义状态转换规则
        self.transition_rules = {
            'pending': ['in_progress', 'cancelled'],
            'in_progress': ['completed', 'failed', 'paused', 'cancelled'],
            'paused': ['in_progress', 'cancelled'],
            'completed': [],
            'failed': ['pending', 'cancelled'],
            'cancelled': []
        }
    
    def can_transition(self, from_state, to_state):
        """检查状态转换是否允许"""
        if from_state not in self.transition_rules:
            return False
        
        return to_state in self.transition_rules[from_state]
    
    def get_possible_transitions(self, current_state):
        """获取当前状态可能的状态转换"""
        if current_state not in self.transition_rules:
            return []
        
        return self.transition_rules[current_state]
    
    def validate_transition(self, task_id, new_state, db_conn=None):
        """验证状态转换是否有效"""
        # 获取当前状态
        if db_conn is None:
            conn = sqlite3.connect('tasks.db')
        else:
            conn = db_conn
        
        c = conn.cursor()
        c.execute('SELECT status FROM tasks WHERE id = ?', (task_id,))
        result = c.fetchone()
        
        if result is None:
            if db_conn is None:
                conn.close()
            return False, "任务不存在"
        
        current_state = result[0]
        
        # 检查状态转换是否允许
        if not self.can_transition(current_state, new_state):
            if db_conn is None:
                conn.close()
            return False, f"不允许从 {current_state} 状态转换到 {new_state} 状态"
        
        if db_conn is None:
            conn.close()
        
        return True, "状态转换有效"

# 全局状态机实例
task_state_machine = TaskStateMachine()
</code></pre>
                </div>
                <div class="footer">第 8 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 7 -->
            <div class="slide" id="slide9">
                <h2 class="slide-title">三、核心技术点：RESTful API设计</h2>
                <div class="slide-content">
                    <p>RESTful API是任务管理系统与前端界面和其他系统组件通信的桥梁。</p>
                    
                    <table>
                        <tr>
                            <th>HTTP方法</th>
                            <th>端点</th>
                            <th>描述</th>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/tasks</td>
                            <td>获取任务列表</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/tasks</td>
                            <td>创建新任务</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/tasks/&lt;id&gt;</td>
                            <td>获取特定任务详情</td>
                        </tr>
                        <tr>
                            <td>PUT</td>
                            <td>/api/tasks/&lt;id&gt;</td>
                            <td>更新任务信息</td>
                        </tr>
                        <tr>
                            <td>DELETE</td>
                            <td>/api/tasks/&lt;id&gt;</td>
                            <td>删除任务</td>
                        </tr>
                        <tr>
                            <td>PUT</td>
                            <td>/api/tasks/&lt;id&gt;/status</td>
                            <td>更新任务状态</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/tasks/&lt;id&gt;/history</td>
                            <td>获取任务状态历史</td>
                        </tr>
                    </table>
                    
                    <div class="explanation-box">
                        <p><strong>设计原则：</strong>遵循RESTful设计原则，使用适当的HTTP方法和状态码。</p>
                    </div>
                </div>
                <div class="footer">第 9 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 8 -->
            <div class="slide" id="slide10">
                <h2 class="slide-title">三、核心技术点：API实现 - 获取任务列表</h2>
                <div class="slide-content">
                    <div class="code-header">API实现代码 - 获取任务列表</div>
                    <pre><code>from flask import Blueprint, request, jsonify
import sqlite3

# 创建蓝图
tasks_bp = Blueprint('tasks', __name__)

@tasks_bp.route('/tasks', methods=['GET'])
def get_tasks():
    """获取任务列表"""
    try:
        conn = sqlite3.connect('tasks.db')
        c = conn.cursor()
        
        # 获取查询参数
        status_filter = request.args.get('status')
        priority_filter = request.args.get('priority')
        type_filter = request.args.get('type')
        
        # 构建查询条件
        query = 'SELECT * FROM tasks'
        conditions = []
        params = []
        
        if status_filter:
            conditions.append('status = ?')
            params.append(status_filter)
        
        if priority_filter:
            conditions.append('priority = ?')
            params.append(priority_filter)
        
        if type_filter:
            conditions.append('type = ?')
            params.append(type_filter)
        
        if conditions:
            query += ' WHERE ' + ' AND '.join(conditions)
        
        query += ' ORDER BY created_at DESC'
        
        c.execute(query, params)
        tasks = c.fetchall()
        
        # 转换为字典列表
        task_list = []
        for task in tasks:
            task_list.append({
                'id': task[0],
                'name': task[1],
                'type': task[2],
                'priority': task[3],
                'status': task[4],
                'parameters': task[5],
                'created_at': task[6],
                'updated_at': task[7]
            })
        
        conn.close()
        
        return jsonify(task_list)
    
    except Exception as e:
        return jsonify({'error': str(e)}), 500
</code></pre>
                </div>
                <div class="footer">第 10 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 9 -->
            <div class="slide" id="slide11">
                <h2 class="slide-title">三、核心技术点：API实现 - 创建任务</h2>
                <div class="slide-content">
                    <div class="code-header">API实现代码 - 创建任务</div>
                    <pre><code>@tasks_bp.route('/tasks', methods=['POST'])
def create_task():
    """创建新任务"""
    try:
        data = request.json
        
        # 验证必需字段
        required_fields = ['name', 'type', 'priority']
        for field in required_fields:
            if field not in data:
                return jsonify({'error': f'缺少必需字段: {field}'}), 400
        
        # 获取当前时间
        now = datetime.now().isoformat()
        
        # 插入数据库
        conn = sqlite3.connect('tasks.db')
        c = conn.cursor()
        
        c.execute('''INSERT INTO tasks 
                     (name, type, priority, status, parameters, created_at, updated_at)
                     VALUES (?, ?, ?, ?, ?, ?, ?)''',
                     (data['name'], data['type'], data['priority'], 'pending',
                      data.get('parameters', ''), now, now))
        
        task_id = c.lastrowid
        
        # 记录状态历史
        c.execute('''INSERT INTO task_status_history 
                     (task_id, status, timestamp, message)
                     VALUES (?, ?, ?, ?)''',
                     (task_id, 'pending', now, '任务创建'))
        
        conn.commit()
        conn.close()
        
        return jsonify({
            'id': task_id,
            'message': '任务创建成功'
        })
    
    except Exception as e:
        return jsonify({'error': str(e)}), 500
</code></pre>
                </div>
                <div class="footer">第 11 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 10 -->
            <div class="slide" id="slide12">
                <h2 class="slide-title">三、核心技术点：API实现 - 更新任务状态</h2>
                <div class="slide-content">
                    <div class="code-header">API实现代码 - 更新任务状态</div>
                    <pre><code>@tasks_bp.route('/tasks/<int:task_id>/status', methods=['PUT'])
def update_task_status(task_id):
    """更新任务状态"""
    try:
        data = request.json
        
        if 'status' not in data:
            return jsonify({'error': '缺少status字段'}), 400
        
        new_status = data['status']
        message = data.get('message', '')
        
        # 验证状态转换
        conn = sqlite3.connect('tasks.db')
        is_valid, error_msg = task_state_machine.validate_transition(task_id, new_status, conn)
        
        if not is_valid:
            conn.close()
            return jsonify({'error': error_msg}), 400
        
        # 获取当前时间
        now = datetime.now().isoformat()
        
        # 更新任务状态
        c = conn.cursor()
        c.execute('UPDATE tasks SET status = ?, updated_at = ? WHERE id = ?',
                  (new_status, now, task_id))
        
        # 记录状态历史
        c.execute('''INSERT INTO task_status_history 
                     (task_id, status, timestamp, message)
                     VALUES (?, ?, ?, ?)''',
                     (task_id, new_status, now, message))
        
        conn.commit()
        conn.close()
        
        return jsonify({'message': '任务状态更新成功'})
    
    except Exception as e:
        return jsonify({'error': str(e)}), 500
</code></pre>
                </div>
                <div class="footer">第 12 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 11 -->
            <div class="slide" id="slide13">
                <h2 class="slide-title">三、核心技术点：前端任务管理界面</h2>
                <div class="slide-content">
                    <p>前端任务管理界面提供了用户与任务管理系统交互的界面。</p>
                    
                    <h3>前端界面关键技术</h3>
                    <ul>
                        <li><strong>HTML/CSS</strong>：构建用户界面结构和样式</li>
                        <li><strong>JavaScript</strong>：实现界面交互和动态功能</li>
                        <li><strong>AJAX/Fetch</strong>：与后端API进行数据交互</li>
                        <li><strong>WebSocket</strong>：实现实时状态更新</li>
                        <li><strong>数据可视化</strong>：展示任务状态和历史信息</li>
                    </ul>
                    
                    <h3>界面组件</h3>
                    <ul>
                        <li>任务管理仪表板</li>
                        <li>任务创建表单</li>
                        <li>任务列表展示</li>
                        <li>任务详情面板</li>
                        <li>实时状态指示器</li>
                    </ul>
                </div>
                <div class="footer">第 13 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 12 -->
            <div class="slide" id="slide14">
                <h2 class="slide-title">三、核心技术点：前端HTML结构</h2>
                <div class="slide-content">
                    <div class="code-header">前端HTML结构</div>
                    <pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;任务管理系统&lt;/title&gt;
    &lt;style&gt;
        /* CSS样式代码 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        /* 更多样式... */
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1&gt;任务管理系统&lt;/h1&gt;
        
        &lt;div class="create-task-form"&gt;
            &lt;h3&gt;创建新任务&lt;/h3&gt;
            &lt;form id="create-task-form"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="task-name"&gt;任务名称&lt;/label&gt;
                    &lt;input type="text" id="task-name" name="name" required&gt;
                &lt;/div&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="task-type"&gt;任务类型&lt;/label&gt;
                    &lt;select id="task-type" name="type" required&gt;
                        &lt;option value=""&gt;请选择任务类型&lt;/option&gt;
                        &lt;option value="navigation"&gt;导航任务&lt;/option&gt;
                        &lt;option value="inspection"&gt;巡检任务&lt;/option&gt;
                        &lt;option value="data_collection"&gt;数据采集&lt;/option&gt;
                    &lt;/select&gt;
                &lt;/div&gt;
                &lt;!-- 更多表单元素... --&gt;
                &lt;button type="submit" class="btn btn-primary"&gt;创建任务&lt;/button&gt;
            &lt;/form&gt;
        &lt;/div&gt;
        
        &lt;div class="task-list" id="task-list"&gt;
            &lt;h3&gt;任务列表&lt;/h3&gt;
            &lt;!-- 任务列表将通过JavaScript动态生成 --&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
        // JavaScript代码将在后续页面展示
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
                </div>
                <div class="footer">第 14 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 13 -->
            <div class="slide" id="slide15">
                <h2 class="slide-title">三、核心技术点：前端JavaScript实现</h2>
                <div class="slide-content">
                    <div class="code-header">前端JavaScript实现 - 加载任务列表</div>
                    <pre><code>// 全局变量
let tasks = [];

// 页面加载完成后执行
document.addEventListener('DOMContentLoaded', function() {
    // 加载任务列表
    loadTasks();
    
    // 绑定表单提交事件
    document.getElementById('create-task-form').addEventListener('submit', function(e) {
        e.preventDefault();
        createTask();
    });
});

// 加载任务列表
function loadTasks() {
    fetch('/api/tasks')
        .then(response => response.json())
        .then(data => {
            tasks = data;
            renderTaskList();
        })
        .catch(error => {
            console.error('Error loading tasks:', error);
            alert('加载任务列表失败');
        });
}

// 渲染任务列表
function renderTaskList() {
    const taskList = document.getElementById('task-list');
    taskList.innerHTML = '&lt;h3&gt;任务列表&lt;/h3&gt;';
    
    if (tasks.length === 0) {
        taskList.innerHTML += '&lt;p&gt;暂无任务&lt;/p&gt;';
        return;
    }
    
    tasks.forEach(task => {
        const taskItem = document.createElement('div');
        taskItem.className = 'task-item';
        
        // 根据状态设置CSS类
        const statusClass = `status-${task.status}`;
        
        taskItem.innerHTML = `
            &lt;div class="task-header"&gt;
                &lt;div class="task-name"&gt;${task.name}&lt;/div&gt;
                &lt;div class="task-status ${statusClass}"&gt;${task.status}&lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="task-details"&gt;
                &lt;div&gt;&lt;strong&gt;类型:&lt;/strong&gt; ${task.type}&lt;/div&gt;
                &lt;div&gt;&lt;strong&gt;优先级:&lt;/strong&gt; ${task.priority}&lt;/div&gt;
                &lt;div&gt;&lt;strong&gt;创建时间:&lt;/strong&gt; ${new Date(task.created_at).toLocaleString()}&lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="task-actions"&gt;
                ${getActionButtons(task)}
            &lt;/div&gt;
        `;
        
        taskList.appendChild(taskItem);
    });
}
</code></pre>
                </div>
                <div class="footer">第 15 页</div>
            </div>
            
            <!-- 第三部分：核心技术点 - 14 -->
            <div class="slide" id="slide16">
                <h2 class="slide-title">三、核心技术点：前端JavaScript实现 - 任务操作</h2>
                <div class="slide-content">
                    <div class="code-header">前端JavaScript实现 - 任务操作</div>
                    <pre><code>// 根据任务状态获取操作按钮
function getActionButtons(task) {
    let buttons = '';
    
    // 查看详情按钮
    buttons += `&lt;button class="btn btn-primary" onclick="viewTaskDetails(${task.id})"&gt;查看详情&lt;/button&gt;`;
    
    // 根据状态显示不同的操作按钮
    if (task.status === 'pending') {
        buttons += `&lt;button class="btn btn-success" onclick="startTask(${task.id})"&gt;开始任务&lt;/button&gt;`;
        buttons += `&lt;button class="btn btn-danger" onclick="cancelTask(${task.id})"&gt;取消任务&lt;/button&gt;`;
    } else if (task.status === 'in_progress') {
        buttons += `&lt;button class="btn btn-success" onclick="completeTask(${task.id})"&gt;完成任务&lt;/button&gt;`;
        buttons += `&lt;button class="btn btn-warning" onclick="pauseTask(${task.id})"&gt;暂停任务&lt;/button&gt;`;
        buttons += `&lt;button class="btn btn-danger" onclick="cancelTask(${task.id})"&gt;取消任务&lt;/button&gt;`;
    } else if (task.status === 'paused') {
        buttons += `&lt;button class="btn btn-success" onclick="resumeTask(${task.id})"&gt;继续任务&lt;/button&gt;`;
        buttons += `&lt;button class="btn btn-danger" onclick="cancelTask(${task.id})"&gt;取消任务&lt;/button&gt;`;
    } else if (task.status === 'failed') {
        buttons += `&lt;button class="btn btn-success" onclick="retryTask(${task.id})"&gt;重试任务&lt;/button&gt;`;
    }
    
    return buttons;
}

// 更新任务状态
function updateTaskStatus(taskId, newStatus, message = '') {
    fetch(`/api/tasks/${taskId}/status`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            status: newStatus,
            message: message
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert('更新任务状态失败: ' + data.error);
        } else {
            alert('任务状态更新成功');
            loadTasks(); // 重新加载任务列表
        }
    })
    .catch(error => {
        console.error('Error updating task status:', error);
        alert('更新任务状态失败');
    });
}

// 各种任务操作函数
function startTask(taskId) {
    updateTaskStatus(taskId, 'in_progress', '任务开始执行');
}

function pauseTask(taskId) {
    updateTaskStatus(taskId, 'paused', '任务已暂停');
}

function resumeTask(taskId) {
    updateTaskStatus(taskId, 'in_progress', '任务继续执行');
}

function completeTask(taskId) {
    updateTaskStatus(taskId, 'completed', '任务已完成');
}

function cancelTask(taskId) {
    if (confirm('确定要取消此任务吗？')) {
        updateTaskStatus(taskId, 'cancelled', '任务已取消');
    }
}

function retryTask(taskId) {
    updateTaskStatus(taskId, 'pending', '任务重试');
}
</code></pre>
                </div>
                <div class="footer">第 16 页</div>
            </div>
            
            <!-- 第四部分：学生动手实践 - 1 -->
            <div class="slide" id="slide17">
                <h2 class="slide-title">四、学生动手实践：数据库初始化与操作</h2>
                <div class="slide-content">
                    <div class="implementation-box">
                        <h3>实践任务1：数据库初始化与操作</h3>
                        <p>按照以下步骤完成数据库的初始化和基本操作：</p>
                        <ol>
                            <li>创建数据库初始化脚本，包含任务表和任务状态记录表</li>
                            <li>实现数据库连接和表创建功能</li>
                            <li>添加必要的索引以提高查询性能</li>
                            <li>编写测试代码验证数据库功能</li>
                        </ol>
                    </div>
                    
                    <div class="code-header">实践代码示例</div>
                    <pre><code># 数据库初始化测试
def test_database_initialization():
    init_database()
    
    # 验证表是否创建成功
    conn = sqlite3.connect('tasks.db')
    c = conn.cursor()
    
    # 检查tasks表是否存在
    c.execute("SELECT name FROM sqlite_master WHERE type='table' AND name='tasks'")
    assert c.fetchone() is not None, "tasks表创建失败"
    
    # 检查task_status_history表是否存在
    c.execute("SELECT name FROM sqlite_master WHERE type='table' AND name='task_status_history'")
    assert c.fetchone() is not None, "task_status_history表创建失败"
    
    conn.close()
    print("数据库初始化测试通过")

if __name__ == '__main__':
    test_database_initialization()
</code></pre>
                    
                    <h3>实践要求</h3>
                    <ul>
                        <li>确保数据库表结构符合设计要求</li>
                        <li>验证外键约束和索引是否正常工作</li>
                        <li>测试数据库连接和基本操作功能</li>
                    </ul>
                </div>
                <div class="footer">第 17 页</div>
            </div>
            
            <!-- 第四部分：学生动手实践 - 2 -->
            <div class="slide" id="slide18">
                <h2 class="slide-title">四、学生动手实践：状态机实现与测试</h2>
                <div class="slide-content">
                    <div class="implementation-box">
                        <h3>实践任务2：状态机实现与测试</h3>
                        <p>按照以下步骤完成状态机的实现和测试：</p>
                        <ol>
                            <li>实现TaskStateMachine类，包含状态转换规则</li>
                            <li>添加状态转换验证方法</li>
                            <li>实现状态转换执行方法</li>
                            <li>编写测试用例验证状态机功能</li>
                        </ol>
                    </div>
                    
                    <div class="code-header">状态机测试代码</div>
                    <pre><code># 状态机测试
def test_state_machine():
    state_machine = TaskStateMachine()
    
    # 测试有效状态转换
    assert state_machine.can_transition('pending', 'in_progress') == True
    assert state_machine.can_transition('in_progress', 'completed') == True
    assert state_machine.can_transition('failed', 'pending') == True
    
    # 测试无效状态转换
    assert state_machine.can_transition('pending', 'completed') == False
    assert state_machine.can_transition('completed', 'pending') == False
    assert state_machine.can_transition('cancelled', 'in_progress') == False
    
    # 测试可能的状态转换
    pending_transitions = state_machine.get_possible_transitions('pending')
    assert 'in_progress' in pending_transitions
    assert 'cancelled' in pending_transitions
    
    print("状态机测试通过")

if __name__ == '__main__':
    test_state_machine()
</code></pre>
                    
                    <h3>实践要求</h3>
                    <ul>
                        <li>确保状态转换规则正确实现</li>
                        <li>验证所有可能的状态转换路径</li>
                        <li>测试边界情况和异常处理</li>
                    </ul>
                </div>
                <div class="footer">第 18 页</div>
            </div>
            
            <!-- 第四部分：学生动手实践 - 3 -->
            <div class="slide" id="slide19">
                <h2 class="slide-title">四、学生动手实践：API接口实现与测试</h2>
                <div class="slide-content">
                    <div class="implementation-box">
                        <h3>实践任务3：API接口实现与测试</h3>
                        <p>按照以下步骤完成API接口的实现和测试：</p>
                        <ol>
                            <li>实现任务列表获取API</li>
                            <li>实现任务创建API</li>
                            <li>实现任务状态更新API</li>
                            <li>编写API测试用例</li>
                        </ol>
                    </div>
                    
                    <div class="code-header">API测试代码</div>
                    <pre><code># API测试
def test_api_endpoints():
    # 创建测试客户端
    app = create_app()
    client = app.test_client()
    
    # 测试创建任务
    response = client.post('/api/tasks', json={
        'name': '测试任务',
        'type': 'navigation',
        'priority': 'high'
    })
    assert response.status_code == 200
    task_id = response.json['id']
    
    # 测试获取任务列表
    response = client.get('/api/tasks')
    assert response.status_code == 200
    assert len(response.json) > 0
    
    # 测试更新任务状态
    response = client.put(f'/api/tasks/{task_id}/status', json={
        'status': 'in_progress'
    })
    assert response.status_code == 200
    
    # 测试无效状态转换
    response = client.put(f'/api/tasks/{task_id}/status', json={
        'status': 'completed'  # 不能直接从in_progress到completed
    })
    assert response.status_code == 400
    
    print("API测试通过")

if __name__ == '__main__':
    test_api_endpoints()
</code></pre>
                    
                    <h3>实践要求</h3>
                    <ul>
                        <li>确保API端点符合RESTful设计原则</li>
                        <li>验证API参数验证和错误处理</li>
                        <li>测试API与状态机的集成</li>
                    </ul>
                </div>
                <div class="footer">第 19 页</div>
            </div>
            
            <!-- 第四部分：学生动手实践 - 4 -->
            <div class="slide" id="slide20">
                <h2 class="slide-title">四、学生动手实践：前端界面实现</h2>
                <div class="slide-content">
                    <div class="implementation-box">
                        <h3>实践任务4：前端界面实现</h3>
                        <p>按照以下步骤完成前端界面的实现：</p>
                        <ol>
                            <li>创建任务管理界面HTML结构</li>
                            <li>实现CSS样式美化界面</li>
                            <li>编写JavaScript实现动态功能</li>
                            <li>实现任务创建和状态更新功能</li>
                        </ol>
                    </div>
                    
                    <div class="code-header">前端界面测试</div>
                    <pre><code>// 前端功能测试
function testFrontendFunctionality() {
    // 测试任务列表渲染
    const mockTasks = [
        {
            id: 1,
            name: '测试任务',
            type: 'navigation',
            priority: 'high',
            status: 'pending',
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString()
        }
    ];
    
    tasks = mockTasks;
    renderTaskList();
    
    // 验证任务列表是否正确渲染
    const taskList = document.getElementById('task-list');
    const taskItems = taskList.querySelectorAll('.task-item');
    assert(taskItems.length === 1, '任务列表渲染失败');
    
    // 验证操作按钮是否正确显示
    const actionButtons = taskItems[0].querySelectorAll('.task-actions button');
    assert(actionButtons.length >= 2, '操作按钮渲染失败');
    
    console.log('前端功能测试通过');
}

// 运行测试
testFrontendFunctionality();
</code></pre>
                    
                    <h3>实践要求</h3>
                    <ul>
                        <li>确保界面美观且用户友好</li>
                        <li>验证前端与后端API的交互</li>
                        <li>测试各种用户操作场景</li>
                    </ul>
                </div>
                <div class="footer">第 20 页</div>
            </div>
            
            <!-- 第四部分：学生动手实践 - 5 -->
            <div class="slide" id="slide21">
                <h2 class="slide-title">四、学生动手实践：系统集成与测试</h2>
                <div class="slide-content">
                    <div class="implementation-box">
                        <h3>实践任务5：系统集成与测试</h3>
                        <p>按照以下步骤完成系统集成和测试：</p>
                        <ol>
                            <li>集成数据库、状态机、API和前端界面</li>
                            <li>测试完整的工作流程</li>
                            <li>验证系统稳定性和性能</li>
                            <li>编写集成测试用例</li>
                        </ol>
                    </div>
                    
                    <div class="code-header">系统集成测试</div>
                    <pre><code># 系统集成测试
def test_system_integration():
    # 初始化系统组件
    init_database()
    state_machine = TaskStateMachine()
    
    # 创建测试客户端
    app = create_app()
    client = app.test_client()
    
    # 测试完整工作流程
    # 1. 创建任务
    response = client.post('/api/tasks', json={
        'name': '集成测试任务',
        'type': 'inspection',
        'priority': 'medium'
    })
    assert response.status_code == 200
    task_id = response.json['id']
    
    # 2. 开始任务
    response = client.put(f'/api/tasks/{task_id}/status', json={
        'status': 'in_progress'
    })
    assert response.status_code == 200
    
    # 3. 完成任务
    response = client.put(f'/api/tasks/{task_id}/status', json={
        'status': 'completed'
    })
    assert response.status_code == 200
    
    # 4. 验证任务状态
    response = client.get(f'/api/tasks/{task_id}')
    assert response.status_code == 200
    assert response.json['status'] == 'completed'
    
    print("系统集成测试通过")

if __name__ == '__main__':
    test_system_integration()
</code></pre>
                    
                    <h3>实践要求</h3>
                    <ul>
                        <li>确保所有组件能够协同工作</li>
                        <li>验证端到端的工作流程</li>
                        <li>测试异常情况和错误处理</li>
                    </ul>
                </div>
                <div class="footer">第 21 页</div>
            </div>
            
            <!-- 第五部分：考核方法 -->
            <div class="slide" id="slide22">
                <h2 class="slide-title">五、考核方法</h2>
                <div class="slide-content">
                    <div class="evaluation-box">
                        <h3>任务管理系统考核标准</h3>
                        <p>本次课程的考核将从以下几个方面进行评价：</p>
                        
                        <table>
                            <tr>
                                <th>考核项目</th>
                                <th>比例</th>
                                <th>评分标准</th>
                            </tr>
                            <tr>
                                <td>数据库设计与实现</td>
                                <td>25%</td>
                                <td>表结构合理性，数据一致性，索引使用，事务处理</td>
                            </tr>
                            <tr>
                                <td>状态机逻辑</td>
                                <td>20%</td>
                                <td>状态转换正确性，异常处理完整性，状态转换限制</td>
                            </tr>
                            <tr>
                                <td>API设计与实现</td>
                                <td>20%</td>
                                <td>符合RESTful规范，错误处理，数据验证，接口文档</td>
                            </tr>
                            <tr>
                                <td>前端界面与交互</td>
                                <td>20%</td>
                                <td>界面美观度，交互流畅性，状态显示清晰度</td>
                            </tr>
                            <tr>
                                <td>系统集成与测试</td>
                                <td>15%</td>
                                <td>组件协同工作能力，测试覆盖率，系统稳定性</td>
                            </tr>
                        </table>
                    </div>
                    
                    <h3>具体评分细则</h3>
                    <ul>
                        <li><strong>优秀(90-100分)</strong>：所有功能完美实现，代码结构清晰，系统稳定运行，文档完整</li>
                        <li><strong>良好(80-89分)</strong>：主要功能实现，代码结构合理，系统基本稳定，文档基本完整</li>
                        <li><strong>中等(70-79分)</strong>：基本功能实现，代码结构一般，系统偶尔不稳定，文档有缺失</li>
                        <li><strong>及格(60-69分)</strong>：核心功能实现，存在明显缺陷但能基本运行</li>
                        <li><strong>不及格(60分以下)</strong>：核心功能未实现或存在严重缺陷</li>
                    </ul>
                </div>
                <div class="footer">第 22 页</div>
            </div>
            
            <!-- 第六部分：调试工具和调试方法 - 1 -->
            <div class="slide" id="slide23">
                <h2 class="slide-title">六、调试工具和调试方法：核心调试工具</h2>
                <div class="slide-content">
                    <p>调试工具帮助开发者快速定位和解决系统开发中的问题。</p>
                    
                    <div class="debug-box">
                        <h3>常用调试工具</h3>
                        <table>
                            <tr>
                                <th>调试工具</th>
                                <th>用途</th>
                                <th>使用示例</th>
                            </tr>
                            <tr>
                                <td>SQLite命令行工具</td>
                                <td>数据库查询与验证</td>
                                <td>.tables / SELECT * FROM tasks</td>
                            </tr>
                            <tr>
                                <td>CURL/PowerShell</td>
                                <td>API端点测试</td>
                                <td>curl -X PUT http://localhost:5000/api/tasks/1/status</td>
                            </tr>
                            <tr>
                                <td>浏览器开发者工具</td>
                                <td>前端调试</td>
                                <td>F12打开控制台，查看网络请求和JavaScript错误</td>
                            </tr>
                            <tr>
                                <td>Python调试器</td>
                                <td>后端代码调试</td>
                                <td>import pdb; pdb.set_trace()</td>
                            </tr>
                            <tr>
                                <td>日志系统</td>
                                <td>系统运行状态追踪</td>
                                <td>logging.basicConfig(level=logging.DEBUG)</td>
                            </tr>
                        </table>
                    </div>
                    
                    <h3>调试脚本示例</h3>
                    <div class="code-header">系统诊断脚本</div>
                    <pre><code>#!/bin/bash
# system_diagnostic.sh

echo "==== 数据库状态检查 ===="
sqlite3 tasks.db ".tables"
echo -e "\n==== 任务表数据 ===="
sqlite3 tasks.db "SELECT * FROM tasks LIMIT 5"
echo -e "\n==== 状态历史表数据 ===="
sqlite3 tasks.db "SELECT * FROM task_status_history LIMIT 5"
echo -e "\n==== API端点测试 ===="
curl -s http://localhost:5000/api/tasks | head -c 200
echo -e "\n====================="
</code></pre>
                </div>
                <div class="footer">第 23 页</div>
            </div>
            
            <!-- 第六部分：调试工具和调试方法 - 2 -->
            <div class="slide" id="slide24">
                <h2 class="slide-title">六、调试工具和调试方法：常见问题排查</h2>
                <div class="slide-content">
                    <p>常见故障现象及排查方法：</p>
                    
                    <table>
                        <tr>
                            <th>故障现象</th>
                            <th>可能原因</th>
                            <th>排查工具</th>
                            <th>解决策略</th>
                        </tr>
                        <tr>
                            <td>数据库连接失败</td>
                            <td>数据库文件权限问题/路径错误</td>
                            <td>ls -l tasks.db</td>
                            <td>修改文件权限/检查文件路径</td>
                        </tr>
                        <tr>
                            <td>API返回500错误</td>
                            <td>后端代码异常</td>
                            <td>Python调试器/日志系统</td>
                            <td>查看异常堆栈，修复代码错误</td>
                        </tr>
                        <tr>
                            <td>前端无法加载任务</td>
                            <td>API端点错误/跨域问题</td>
                            <td>浏览器开发者工具</td>
                            <td>检查网络请求，修复API端点</td>
                        </tr>
                        <tr>
                            <td>状态转换失败</td>
                            <td>状态机规则错误</td>
                            <td>状态机调试工具</td>
                            <td>验证状态转换规则，修复逻辑错误</td>
                        </tr>
                        <tr>
                            <td>任务列表显示异常</td>
                            <td>前端渲染逻辑错误</td>
                            <td>浏览器开发者工具</td>
                            <td>检查JavaScript代码，修复渲染逻辑</td>
                        </tr>
                    </table>
                    
                    <div class="debug-box">
                        <h3>调试最佳实践</h3>
                        <ul>
                            <li><strong>分而治之</strong>：将系统分成多个部分，逐一排查</li>
                            <li><strong>日志记录</strong>：在关键位置添加日志，追踪程序执行流程</li>
                            <li><strong>单元测试</strong>：为每个模块编写测试用例，确保功能正确性</li>
                            <li><strong>版本控制</strong>：使用Git管理代码，便于回滚和问题追踪</li>
                            <li><strong>文档记录</strong>：详细记录调试过程和解决方案</li>
                        </ul>
                    </div>
                </div>
                <div class="footer">第 24 页</div>
            </div>
            
            <!-- 第六部分：调试工具和调试方法 - 3 -->
            <div class="slide" id="slide25">
                <h2 class="slide-title">六、调试工具和调试方法：调试流程总结</h2>
                <div class="slide-content">
                    <p>系统化调试流程：</p>
                    
                    <table>
                        <tr>
                            <th>步骤</th>
                            <th>操作</th>
                            <th>工具/方法</th>
                        </tr>
                        <tr>
                            <td>1. 问题重现</td>
                            <td>确定问题发生的条件和频率</td>
                            <td>用户报告、日志分析</td>
                        </tr>
                        <tr>
                            <td>2. 信息收集</td>
                            <td>收集系统状态和日志信息</td>
                            <td>监控工具、日志系统</td>
                        </tr>
                        <tr>
                            <td>3. 问题定位</td>
                            <td>确定问题发生的模块和原因</td>
                            <td>调试工具、代码分析</td>
                        </tr>
                        <tr>
                            <td>4. 解决方案</td>
                            <td>制定并实施解决方案</td>
                            <td>代码修改、配置调整</td>
                        </tr>
                        <tr>
                            <td>5. 验证测试</td>
                            <td>验证解决方案的有效性</td>
                            <td>测试用例、回归测试</td>
                        </tr>
                        <tr>
                            <td>6. 预防措施</td>
                            <td>防止问题再次发生</td>
                            <td>监控告警、代码审查</td>
                        </tr>
                    </table>
                    
                    <div class="debug-box">
                        <h3>调试成功要素</h3>
                        <ul>
                            <li><strong>系统知识</strong>：深入了解系统架构和工作原理</li>
                            <li><strong>工具熟练</strong>：熟练掌握各种调试工具的使用方法</li>
                            <li><strong>方法论</strong>：掌握系统化的调试方法和流程</li>
                            <li><strong>经验积累</strong>：通过实践不断积累调试经验</li>
                            <li><strong>团队协作</strong>：与团队成员协作，共同解决问题</li>
                        </ul>
                    </div>
                    
                    <div class="explanation-box">
                        <p><strong>总结：</strong>任务管理系统是机器人物联网云控系统的核心组件，通过本次课程的学习，学生应该掌握了数据库设计、状态机实现、API开发、前端界面和系统集成等关键技术，为后续课程和实际项目开发奠定了基础。</p>
                    </div>
                </div>
                <div class="footer">第 25 页</div>
            </div>
            
            <!-- 幻灯片结束 -->
        </div>
    </div>

    <script>
        // 当前幻灯片索引
        let currentSlide = 1;
        const totalSlides = 25;
        
        // 导航函数
        function navigate(direction) {
            if (direction === 'next' && currentSlide < totalSlides) {
                currentSlide++;
            } else if (direction === 'prev' && currentSlide > 1) {
                currentSlide--;
            } else if (direction === 'home') {
                currentSlide = 1;
            }
            
            // 滚动到目标幻灯片
            const targetSlide = document.getElementById(`slide${currentSlide}`);
            if (targetSlide) {
                targetSlide.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // 导出PDF函数
        function exportToPDF() {
            // 使用jsPDF和html2canvas库导出PDF
            const { jsPDF } = window.jspdf;
            
            // 提示用户正在生成PDF
            alert('正在生成PDF文档，请稍候...');
            
            // 获取所有幻灯片
            const slides = document.querySelectorAll('.slide');
            const pdf = new jsPDF('p', 'mm', 'a4');
            
            // 递归函数，依次处理每个幻灯片
            function generatePDF(index) {
                if (index >= slides.length) {
                    // 所有幻灯片处理完成，保存PDF
                    pdf.save('任务管理系统实现-PPT课件.pdf');
                    return;
                }
                
                const slide = slides[index];
                
                // 使用html2canvas将幻灯片转换为图片
                html2canvas(slide, {
                    scale: 2,
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    // 将canvas转换为图片数据
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    
                    // 获取PDF页面尺寸
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    
                    // 计算图片在PDF中的尺寸
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                    const imgX = (pdfWidth - imgWidth * ratio) / 2;
                    const imgY = 0;
                    
                    // 添加新页面（第一页不需要添加）
                    if (index > 0) {
                        pdf.addPage();
                    }
                    
                    // 将图片添加到PDF
                    pdf.addImage(imgData, 'JPEG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
                    
                    // 处理下一张幻灯片
                    generatePDF(index + 1);
                });
            }
            
            // 开始生成PDF
            generatePDF(0);
        }
        
        // 添加键盘导航支持
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowRight' || event.key === 'PageDown') {
                navigate('next');
            } else if (event.key === 'ArrowLeft' || event.key === 'PageUp') {
                navigate('prev');
            } else if (event.key === 'Home') {
                navigate('home');
            }
        });
        
        // 初始滚动到第一页
        window.onload = function() {
            navigate('home');
        };
    </script>
</body>
</html>